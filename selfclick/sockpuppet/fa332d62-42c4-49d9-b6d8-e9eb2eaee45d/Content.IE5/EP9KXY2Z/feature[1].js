(function(){window.local_features_model={wps_recent_files:{name:"",query:{"detail.name":"","detail.path":"","detail.size":"","detail.access_time":"","detail.modify_time":"","detail.is_cloud_file":"","detail.app":""}},file_operation:{name:"",source:{time:""},query:{time:"","detail.name":"","detail.modify_time":""}},browser_history:{name:"",source:{time:""},query:{time:"","detail.title":"","detail.url":""}},bubble_popup:{name:"",source:{time:""},query:{time:"","detail.bubble_id":"","detail.bubble_name":"","detail.msgGroup":""}},bubble_close:{name:"",source:{time:""},query:{time:"","detail.bubble_id":"","detail.bubble_name":"","detail.msgGroup":"","detail.aliveTime":"","detail.type":""}},bubble_click:{name:"",source:{time:""},query:{time:"","detail.bubble_id":"","detail.bubble_name":"","detail.msgGroup":"","detail.checkbox":"","detail.mistake":""}},notify_history:{name:"",source:{time:""},query:{time:"","detail.name":"","detail.all_day_num":""}},process:{name:"",source:{},query:{"detail.name":""}},desktop_icon:{name:"",source:{},query:{"detail.name":""}}}}).call(this);
(function(){var e;e=new RegExp("development").test(sdk.env),window.featureConfig={enable:!0,computeInterval:e?18e5:864e5,modelLoadInterval:864e5,cleanIniInterval:432e6,dbName:"feature.db",dbSourceTable:"feature_source",dbConfigTable:"feature_model"}}).call(this);
(function(){var e;e={local_feature:{deleteCycle:24,expired:365},browser_history:{insertApi:function(e,r,t){return this.getCurBrowserHistory(e,r,t)},getAllBrowserHistory:function(e,r,t,i){return sdk.system.getAllBrowserHistory(e,r,this.insertMax,function(s,o,n){var l,u,y,a;if(u=[],0!==s){for(l=0,y=o.length;l<y;l++)a=o[l],a.browser=n,u.push({type:"browser_history",time:1e3*a.visit_time,detail:sdk.util.serialize(a)});return t(u)}return i&&i(e,r,t)})},getCurBrowserHistory:function(e,r,t){return sdk.system.getBrowserHistory(e,r,this.insertMax,function(e,r){var i,s,o,n;for(s=[],i=0,o=e.length;i<o;i++)n=e[i],n.browser=r||"default",s.push({type:"browser_history",time:1e3*n.visit_time,detail:sdk.util.serialize(n)});return t(s)})},insertMax:1e3,insertCycle:1,deleteCycle:24,expired:15}},window.collectorConfig=e}).call(this);
(function(){var e,t,i,n={}.hasOwnProperty;e=window.featureConfig.dbName,i=window.featureConfig.dbSourceTable,t={iniGroupName:"FeatureLoad",insert:function(t){var s,o,r,l,u,d,a;a=0,l=!1,u=window.collectorConfig;for(d in u)if(n.call(u,d)&&(s=u[d],s.insertApi&&s.insertCycle)){if(this.getLastInsertTime(d)-0>sdk.util.getNow()-0-3600*s.insertCycle*1e3){sdk.noop();continue}a++;try{s.insertApi(this.getLastInsertTime(d)-0,sdk.util.getNow()-0,function(n){var s;return s=function(){if(a--,l&&0===a)return t&&t()},sdk.util.db.insert(e,i,n,s,s)})}catch(r){o=r,sdk.noop()}this.setLastInsertTime(d)}if(l=!0,0===a)return sdk.noop(),t&&t()},"delete":function(e){var t,i,s,o,r;r=0,i=!1,s=window.collectorConfig;for(o in s)if(n.call(s,o)&&(t=s[o],t.deleteCycle)){if(this.getLastDeleteTime(o)-0>sdk.util.getNow()-0-3600*t.deleteCycle*1e3){sdk.noop();continue}sdk.noop(),r++,this.setLastDeleteTime(o),this.deleteApi(o,t.expired,function(){if(r--,i&&0===r)return e&&e()})}if(i=!0,0===r)return sdk.noop(),e&&e()},deleteApi:function(t,n,s){return null==n&&(n=7),n=sdk.util.getNow()-24*n*3600*1e3,sdk.util.db["delete"](e,i,{type:"="+t,time:"<"+n},s,s)},getLastInsertTime:function(e){return sdk.util.getIni(this.iniGroupName,e+"_last_insert_time")-0||0},setLastInsertTime:function(e,t){return null==t&&(t=sdk.util.getNow()),sdk.util.setIni(this.iniGroupName,e+"_last_insert_time",t-0)},getLastDeleteTime:function(e){return sdk.util.getIni(this.iniGroupName,e+"_last_delete_time")-0||0},setLastDeleteTime:function(e,t){return null==t&&(t=sdk.util.getNow()),sdk.util.setIni(this.iniGroupName,e+"_last_delete_time",t-0)}},window.collectorService=t}).call(this);
(function(){var dbName,source,sourceMap,tableName;dbName=window.featureConfig.dbName,tableName=window.featureConfig.dbSourceTable,sourceMap={desktop_icon:function(){var e,t,r,n,i;for(r=sdk.system.listDesktopLinks(),i=[],e=0,n=r.length;e<n;e++)t=r[e],i.push({type:"desktop_icon",detail:{name:t}});return function(e,t){return t(i)}}(),process:function(){var e,t,r,n,i;for(n=sdk.system.listProcesses(),i=[],e=0,t=n.length;e<t;e++)r=n[e],i.push({type:"process",detail:{name:r}});return function(e,t){return t(i)}}(),wps_recent_files:function(){var e;return e=null,function(t,r){return null!=e?r(e):sdk.client.plugin.getWpsRecentFiles(["wps","wpp","et"],function(t){var n,i,a;for(e=[],n=0,a=t.length;n<a;n++)i=t[n],e.push({type:"wps_recent_files",detail:{name:i.name,path:i.path,size:i.size,access_time:sdk.util.parseDate(i.access_time)-0,modify_time:sdk.util.parseDate(i.modify_time)-0,is_cloud_file:i.is_cloud_file,app:i.app}});return r(e)})}}()},source={_getFromDatabase:function(type,query,cb){return sdk.noop(),query.push({type:"="+type}),sdk.util.db.select(dbName,tableName,query,function(arr){var detail,err,error,i,item,len;for(i=0,len=arr.length;i<len;i++){item=arr[i];try{detail=eval("("+item.detail+")"),item.detail=detail}catch(error){err=error,sdk.noop(),item.detail={}}}return cb&&cb(arr)})},getSource:function(e,t,r){return null==r&&(r=sdk.noop),sourceMap.hasOwnProperty(e)?sourceMap[e](t,r):this._getFromDatabase(e,t,r)}},window.featureSource=source}).call(this);
(function(){var compute,dbName,tableName;dbName=window.featureConfig.dbName,tableName=window.featureConfig.dbSourceTable,compute={compute:function(e,r){var o,t,n,c,d,a,u,i;try{for(i=0,c=!1,d=function(e){return function(o){var t,n;return i++,t=e._parseConfig(o),sdk.noop(),sdk.noop(),n=e.getAllModelScore(t.model,function(o){return sdk.noop(),e.recordFeature(t,o,function(){if(i--,c&&0===i)return r&&r()})})}}(this),a=0,u=e.length;a<u;a++)o=e[a],d(o);if(c=!0,0===i)return sdk.noop(),r&&r()}catch(n){return t=n,sdk.noop(),r&&r()}},_parseConfig:function(config){var err,error,modelList;modelList=[];try{modelList=eval("("+config.model+")")}catch(error){err=error,sdk.noop()}return Array.isArray(modelList)||(sdk.noop(),modelList=[]),{_id:config._id,_name:config._name,name:config.name,model:modelList}},getModelScore:function(model,cb){return sdk.noop(),featureSource.getSource(model.type,model.source,function(_this){return function(sourceList){var _verify,cond,conds,dataLength,dataScore,flag,i,j,k,key,len,len1,length,part,query,ref,ref1,ref2,score,source,tmp,total;for(sdk.noop(),_verify=function(key,cond,source){var err,error,execFunc,index,key1,key2;if("_custom"===key)try{return(execFunc=eval("(function() {return "+cond+"})()"))(source)}catch(error){err=error,sdk.noop()}return(index=key.indexOf("."))>-1?(key1=key.slice(0,index),key2=key.slice(index+1),source[key1]?sdk.util.compare(source[key1][key2],cond):void 0):sdk.util.compare(source[key],cond)},dataLength=[],dataLength.push(sourceList.length),ref=model.query,i=j=0,len=ref.length;j<len;i=++j){for(query=ref[i],tmp=[],k=0,len1=sourceList.length;k<len1;k++){source=sourceList[k],flag=!0;for(key in query)if(cond=query[key],sdk.noop(),!_verify(key,cond,source)){flag=!1;break}flag&&tmp.push(source)}dataLength.push(tmp.length),sourceList=tmp,sdk.noop()}if(dataScore=0,model.result.length){ref1=model.result.length;for(score in ref1)if(conds=ref1[score],dataScore<score-0){flag=!0;for(cond in conds)if(length=conds[cond],!sdk.util.compareFunc[cond]||!sdk.util.compareFunc[cond](sourceList.length,length-0)){flag=!1;break}flag&&(dataScore=score-0)}}if(model.result.percentage){ref2=model.result.percentage;for(score in ref2)if(conds=ref2[score],dataScore<score-0){total=dataLength[conds.total]-0,part=dataLength[conds.part]-0,delete conds.total,delete conds.part,flag=!0;for(cond in conds)if(length=conds[cond],sdk.noop(),!sdk.util.compareFunc[cond]||!sdk.util.compareFunc[cond](part/total*100,length-0)){flag=!1;break}flag&&(dataScore=score-0)}}return sdk.noop(),cb(dataScore)}}(this))},getAllModelScore:function(e,r){var o,t,n,c,d,a,u,i;for(t=0,o=0,n=0,e.length||r(0),i=[],u=c=0,d=e.length;c<d;u=++c)a=e[u],i.push(function(c){return function(d){return c.getModelScore(d,function(c){if(n++,o+=c*d.weight,t+=d.weight,n===e.length)return o*=10,r(Math.round(o/t))})}}(this)(a));return i},recordFeature:function(e,r,o){var t,n,c;return sdk.feature.setFeatureScore(e._name,r),sdk.service.info.reportTag(e.name,r,e._id),c=.01,1===Math.ceil(Math.random()/c)&&sdk.util.justSend("http://pcfg.wps.cn:9002/config/info/popup/"+e._id+"/"+c+"/"+r),n={feature_id:e._id,feature_name:e._name,name:e.name,score:r},t={type:"local_feature",time:sdk.util.getNow()-0,detail:n},sdk.util.db.insert(dbName,tableName,t,o,o)},_str2Model:function(str){var err,error,model;model=[];try{return model=eval("("+str+")")}catch(error){return err=error,sdk.noop()}}},window.featureCompute=compute}).call(this);
(function(){var iniGroupName,keyTimeLastCleanModel,keyTimeLastLoadModel,modelService;iniGroupName="FeatureLoad",keyTimeLastLoadModel="time_last_load_model",keyTimeLastCleanModel="time_last_clean_model",modelService={getFeatureModel:function(e){return sdk.util.getNow()-this._getLastCleanTime()>window.featureConfig.cleanIniInterval?this._setFeatureModelToLocal([],function(t){return function(){return t._setLastCleanTime(),t._setLastLoadTime(0),t._getFeatureModel(e)}}(this)):this._getFeatureModel(e)},_ifLocalConfigExpires:function(e){var t;return t=this._getLastLoadTime()-0,sdk.util.ajax({url:"http://js1.pcfg.cache.wpscdn.cn/platform_lmt/local_features",type:"get",timeout:10,success:function(i){var o,n;i-=0,sdk.noop();try{return e&&e(t<i)}catch(n){return o=n,sdk.noop()}},error:function(t){return sdk.noop(),e&&e(!0)}})},_getFeatureModel:function(e){return window.featureConfig.enable?sdk.util.getNow()-this._getLastLoadTime()<window.featureConfig.modelLoadInterval?(sdk.noop(),this._getFeatureModelFromLocal(e)):this._ifLocalConfigExpires(function(t){return function(i){return i?(sdk.noop(),t._getFeatureModelFromService(e)):(sdk.noop(),t._getFeatureModelFromLocal(e))}}(this)):(sdk.noop(),e&&e([]))},_getFeatureModelFromService:function(cb){return this._loadFeatureModelUrl(function(_this){return function(ret){var configList,err,error,listTmp;try{ret=eval("("+ret+")")}catch(error){err=error,sdk.noop()}return configList=ret.data||[],listTmp=[],_this._getFeatureModelFromLocal(function(e){var t,i,o,n,r,s,a,l;for(l={},o=0,s=e.length;o<s;o++)i=e[o],l[i._id]=i;for(n=r=0,a=configList.length;r<a;n=++r)i=configList[n],t=i._id,i._last_modify_time?listTmp.push(i):l[t]?listTmp.push(l[t]):sdk.noop();return configList=listTmp,sdk.util.setNow(ret.timestamp||sdk.util.getNow()),_this._setLastLoadTime(),_this._setFeatureModelToLocal(configList,function(){return cb&&cb(configList)})})}}(this))},_loadFeatureModelUrl:function(e){return this._getFeatureModelFromLocal(function(t){return function(i){var o,n,r,s,a,l,u,d,c,f,m,_,g;for(i=i||[],d={},a=0,u=i.length;a<u;a++)n=i[a],d[n._id]=n._last_modify_time-0;o=t._getCityFromIni(),c={_hdid:sdk.client.info.getHdid(),_city:sdk.util.aesEncrypt(o)||o,_dist:sdk.client.info.getDistNum(),_client_name:sdk.client.info.getAppName(),_client_version:sdk.client.info.getAppVersion(),_os_name:sdk.system.getOsName(),_t:sdk.util.getNow()-0},g=!1;for(l in d)_=d[l],_?g=!0:delete d[l];g&&(c._last_load_time=t._getLastLoadTime(),c._local_modify=sdk.util.serialize(d));try{m="http://pcfg.wps.cn/config/local_features/list",f=[];for(l in c)_=c[l],"ruby"!==sdk.platform&&(_=encodeURIComponent(_)),_&&f.push(l+"="+_);f.length>0&&(m+="?"+f.join("&")),sdk.util.ajax({url:m,type:"get",timeout:10,success:function(t){return sdk.noop(),e&&e(t)},error:function(t){return sdk.noop(),e&&e("")}})}catch(s){r=s,sdk.noop()}return sdk.noop()}}(this))},_getLastLoadTime:function(){return sdk.util.getIni(iniGroupName,keyTimeLastLoadModel)-0||0},_setLastLoadTime:function(e){return null==e&&(e=sdk.util.getNow()),sdk.util.setIni(iniGroupName,keyTimeLastLoadModel,e-0)},_getLastCleanTime:function(){return sdk.util.getIni(iniGroupName,keyTimeLastCleanModel)-0||0},_setLastCleanTime:function(e){return null==e&&(e=sdk.util.getNow()),sdk.util.setIni(iniGroupName,keyTimeLastCleanModel,e-0)},_getCityFromIni:function(){var e;return e=sdk.tools.storage.get("city")||"",sdk.util.decodeBase64(e)},_getFeatureModelFromLocal:function(cb){return sdk.util.db.select(featureConfig.dbName,featureConfig.dbConfigTable,null,function(list){var err,error,ret;if(!list.length||!list[0].detail)return cb&&cb([]);try{ret=eval("("+sdk.util.decodeBase64(list[0].detail)+")")}catch(error){err=error,sdk.noop(),ret=[]}return cb&&cb(ret)})},_setFeatureModelToLocal:function(e,t){var i;return i=sdk.util.encodeBase64(sdk.util.serialize(e)),sdk.util.db["delete"](featureConfig.dbName,featureConfig.dbConfigTable,null,function(){return sdk.util.db.insert(featureConfig.dbName,featureConfig.dbConfigTable,{detail:i,time:sdk.util.getNow()-0},t,t)})}},window.featureModelService=modelService}).call(this);
(function(){var t;t=function(){function t(){var t,e;if(this.alive=!0,this.appName=sdk.client.info.getAppName(),this.today=sdk.util.formatDate(sdk.util.getNow(),"yyyy_MM_dd"),this.iniGroupName="FeatureLoad",this.keyFeatureLoadNumToday="feature_load_num_"+this.today,this.keyFeatureLastLoadTime="feature_last_load_time_",!this.inValidEnv())return this.alive=!1,sdk.noop();if(sdk.util.getNow()-this.getFeatureLastLoadTime()>window.featureConfig.computeInterval){sdk.noop();try{this.init(function(t){return function(){return sdk.noop(),window.collectorService["delete"](function(){return sdk.noop(),window.collectorService.insert(function(){return sdk.noop(),t.start()})})}}(this))}catch(e){t=e,sdk.noop()}}else sdk.noop(),this.end()}return t.prototype.start=function(){return sdk.noop(),this.setFeatureLastLoadTime(),this.incrFeatureLoadNumToday(),this.report(),this.setSwitchConfig(function(t){return function(){return window.featureModelService.getFeatureModel(function(e){return window.featureCompute.compute(e,function(){return t.end()})})}}(this))},t.prototype.inValidEnv=function(){return sdk.util.db.available()},t.prototype.init=function(t){return sdk.util.db.exec(window.featureConfig.dbName,"CREATE TABLE IF NOT EXISTS "+window.featureConfig.dbSourceTable+"( id INTEGER PRIMARY KEY   AUTOINCREMENT, type           TEXT      NOT NULL, time            INT      NOT NULL, detail         TEXT      NOT NULL ); CREATE TABLE IF NOT EXISTS "+window.featureConfig.dbConfigTable+"( id INTEGER PRIMARY KEY   AUTOINCREMENT, time            INT      NOT NULL, detail         TEXT      NOT NULL );",function(){return t&&t()},function(t){return sdk.noop()})},t.prototype.end=function(){return sdk.util.db.closeAll(function(t){return function(){return t.alive=!1,sdk.noop()}}(this))},t.prototype.setSwitchConfig=function(t){return sdk.noop(),sdk.util.httpGet("//switch.pcfg.cache.wpscdn.cn/wps_assets/cfg/ad/switch/local_features",{},function(e){return function(e){var n,o,i,r,u,a,s,d,f,c;sdk.noop();try{if(/-1\s*/.test(e))window.featureConfig.enable=!1;else{for(f={},o=e.split("\n"),u=0,d=o.length;u<d;u++)n=o[u],a=n.indexOf("="),s=n.substr(0,a),c=n.substr(a+1),isNaN(c-0)||(c-=0),window.featureConfig[s]=c;window.featureConfig.enable=!0}}catch(r){i=r,sdk.noop()}return t&&t()}}(this),function(e){return function(e){return sdk.noop(),t&&t()}}(this))},t.prototype.getFeatureLastLoadTime=function(){return sdk.util.getIni(this.iniGroupName,this.keyFeatureLastLoadTime)-0||0},t.prototype.setFeatureLastLoadTime=function(t){return null==t&&(t=sdk.util.getNow()),sdk.util.setIni(this.iniGroupName,this.keyFeatureLastLoadTime,t-0)},t.prototype.getFeatureLoadNumToday=function(){return sdk.util.getIni(this.iniGroupName,this.keyFeatureLoadNumToday)-0||0},t.prototype.incrFeatureLoadNumToday=function(){var t;return t=this.getFeatureLoadNumToday(),sdk.util.setIni(this.iniGroupName,this.keyFeatureLoadNumToday,++t)},t.prototype.report=function(){if(1===Math.floor(1e3*Math.random()))return sdk.util.justSend("http://pcfg.wps.cn:9002/report/feature/load/"+this.getFeatureLoadNumToday())},t}(),setTimeout(function(){return window.featureService=new t},1e4)}).call(this);
// 64485086370F9D5335EAB0E35DE821723BB10683390CD8DC33B68733BF574DED5CCFA6BCD1103B812520733A80C3C928652B712468A565C754BCEAA8A97093D2